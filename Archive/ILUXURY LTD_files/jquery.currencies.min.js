/*
 * Cookie plugin
 *
 * Copyright (c) 2006 Klaus Hartl (stilbuero.de)
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 */

jQuery.cookie=function(b,j,m){
	if(typeof j!="undefined"){
		m=m||{};
		if(j===null){
			j="";
			m.expires=-1
		}
		var e="";
		if(m.expires&&(typeof m.expires=="number"||m.expires.toUTCString)){
			var f;
			if(typeof m.expires=="number"){
				f=new Date();
				f.setTime(f.getTime()+(m.expires*24*60*60*1000))
			}
			else{
				f=m.expires
			}
			e="; expires="+f.toUTCString()
		}
		var l=m.path?"; path="+(m.path):"";
		var g=m.domain?"; domain="+(m.domain):"";
		var a=m.secure?"; secure":"";

		document.cookie=[b,"=",encodeURIComponent(j),e,l,g,a].join("")
	}
	else{
		var d=null;
		if(document.cookie&&document.cookie!=""){
			var k=document.cookie.split(";");
			for(var h=0;h<k.length;h++){
				var c=jQuery.trim(k[h]);
				if(c.substring(0,b.length+1)==(b+"=")){
					d=decodeURIComponent(c.substring(b.length+1));
					break
				}
			}
		}
		return d
	}
};

/*
 * Currency tools
 *
 * Copyright (c) 2013 Caroline Schnapp (mllegeorgesand@gmail.com)
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/mit-license.php
 *
 */ 

if(typeof Currency==="undefined"){
	var Currency={}
}

Currency.cookie={
	configuration:{
		expires:365,
		path:"/",
		domain:window.location.hostname
	},
	name:"currency",
	write:function(a){
		jQuery.cookie(this.name,a,this.configuration)
	},
	read:function(){
		return jQuery.cookie(this.name)
	},
	destroy:function(){
		jQuery.cookie(this.name,null,this.configuration)
	}
};

Currency.money_with_currency_format={
};

Currency.money_format={
};

Currency.formatMoney=function(b,f,h,i){
	if(typeof b=="string"){
		b=b.replace(".","")
	}
	var e="";
	var d=/\{\{\s*(\w+)\s*\}\}/;
	var a=(f||this.money_format);
	function c(g){
		g += '';
		x = g.split('.');
		x1 = x[0];
		x2 = x.length > 1 ? '.' + x[1] : '';
		var rgx = /(\d+)(\d{3})/;
		while (rgx.test(x1)) {
			x1 = x1.replace(rgx, '$1' + ',' + '$2');
		}
		x1 = x1.replace(/,/g, i);
		return x1 + x2;
	}

	switch(a.match(d)[1]){
		case"amount":
		e=c(floatToString(b/100,h));
		break;

		case"amount_no_decimals":
		e=c(floatToString(b/100,0));
		break;

		case"amount_with_comma_separator":
		e=floatToString(b/100,2).replace(/\./,",");
		break;

		case"amount_no_decimals_with_comma_separator":
		e=c(floatToString(b/100,0)).replace(/\./,",");
		break
	}

	return a.replace(d,e)
};

function floatToString(c,a){
	var b=c.toFixed(a).toString();
	if(b.match(/^\.\d+/)){
		return"0"+b
	}
	else{
		return b
	}
}

Currency.currentCurrency="";
Currency.format="money_with_currency_format";

Currency.convertAll=function(c,b,a,d){
	jQuery(a||"span.money").each(function(){
		if(jQuery(this).attr("data-currency")===b){
			return
		}
		// if(jQuery(this).attr("data-currency-"+b)){
		// 	jQuery(this).html(jQuery(this).attr("data-currency-"+b))
		// }
		else{
			var e=0;
			var f=Currency[d||Currency.format][c]||"{{amount}}";
			var g=Currency[d||Currency.format][b]||"{{amount}}";
			var i=Currency.money_decimal[b];
			var j=Currency.money_separator[b];

			if(f.indexOf("amount_no_decimals")!==-1){
				e=Currency.convert(parseInt(jQuery(this).html().replace(/[^0-9]/g,""),10)*100,c,b)
			}
			else{
				if(c==="JOD"||c=="KWD"||c=="BHD"){
					e=Currency.convert(parseInt(jQuery(this).html().replace(/[^0-9]/g,""),10)/10,c,b)
				}
				else{
					var ori_price = jQuery(this).data("ori-price");
					e=Currency.convert(parseInt(ori_price.toString().replace(/[^0-9]/g,""),10),c,b)
				}
			}
			var h=Currency.formatMoney(e,g,i,j);
			jQuery(this).html(h);
			jQuery(this).attr("data-currency-"+b,h)
		}
		jQuery(this).attr("data-currency",b)
	});
	this.currentCurrency=b;this.cookie.write(b)
};